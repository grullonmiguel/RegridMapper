<UserControl x:Class="RegridMapper.Views.ParcelView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:local="clr-namespace:RegridMapper.Views">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Page Title -->
        <TextBlock Style="{StaticResource TextBlocks.Heading1}" Margin="0 16">
            <Run Text="Regrid" />
            <Run Text="{Binding TotalParcels, Mode=OneWay}" />
        </TextBlock>

        <!-- Main Content -->
        <Border Grid.Row="1" Style="{StaticResource Borders.Secondary}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition />
                </Grid.RowDefinitions>

                <!-- Buttons -->
                <Border Padding="8 12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition />
                            <ColumnDefinition Width="auto"  />
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="auto" />
                        </Grid.ColumnDefinitions>

                        <!-- Cancel -->
                        <Button 
                            Content="Cancel" 
                            Tag="{StaticResource Geometry.WebCancel}"
                            Style="{StaticResource  Buttons.Link}" 
                            Command="{Binding RegridQueryCancelCommand}"
                            Visibility="{Binding IsScraping, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        
                        <!-- Running-->
                        <TextBlock Foreground="#f69465" VerticalAlignment="Center" Grid.Column="1">
                            <Run Text="{Binding RegridStatus}" />
                            <Run Text="{Binding CurrentScrapingElement}" />
                        </TextBlock>
                        
                        <!-- Paste -->
                        <Button 
                            Grid.Column="2"
                            Content="Paste" 
                            Margin="4 0"
                            Tag="{StaticResource Geometry.Paste}"
                            Style="{StaticResource  Buttons.Link}" 
                            Command="{Binding LoadFromClipboardCommand}" />
                        
                        <!-- Copy -->
                        <Button 
                            Grid.Column="3"
                            Content="Copy" 
                            Margin="4 0"
                            Tag="{StaticResource Geometry.Copy}"
                            Style="{StaticResource  Buttons.Link}"  
                            Command="{Binding CopyAllToClipboardCommand}" />

                        <!-- Clear -->
                        <Button 
                            Grid.Column="4"
                            Content="Delete" 
                            Margin="4 0 8 0"
                            Tag="{StaticResource Geometry.Delete}"
                            Command="{Binding ClearDataCommand}" 
                            Style="{StaticResource  Buttons.Link}"/>
                        
                        <!-- Regrid -->
                        <Button 
                            Grid.Column="5"
                            Content="Scrape" 
                            IsEnabled="{Binding CanScrape}"
                            Tag="{StaticResource Geometry.Regrid}"
                            Style="{StaticResource  Buttons.Primary}"
                            Command="{Binding RegridQueryAllParcelsCommand}"  />
                    </Grid>
                </Border>

                <!-- Parcel DataGrid -->
                <DataGrid 
                    Grid.Row="1" HorizontalScrollBarVisibility="Auto"
                    ItemsSource="{Binding ParcelList}"  HeadersVisibility="Column" >
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Parcel ID" Binding="{Binding ParcelID}" Width="150" />
                        <DataGridTemplateColumn Header="Status" Width="150">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Border BorderBrush="#f6dd65" BorderThickness="1" Background="#30f6dd65" Padding="6 4" CornerRadius="6"
                                                Visibility="{Binding MultipleMatchesFound, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <StackPanel Orientation="Horizontal">
                                                <Viewbox Width="14" Height="14">
                                                    <Path Data="{StaticResource Geometry.Alert}" Fill="#f6dd65"  />
                                                </Viewbox>
                                                <TextBlock Text="Multiple Matches" Foreground="#f6dd65" Margin="8 0 0 0" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </Border>
                                        <Border BorderBrush="#ff8686" BorderThickness="1" Background="#30ff8686" Padding="6 4" CornerRadius="6"
                                                Visibility="{Binding NoMatchDetected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <StackPanel Orientation="Horizontal">
                                                <Viewbox Width="14" Height="14">
                                                    <Path Data="{StaticResource Geometry.Alert}" Fill="#ff8686" />
                                                </Viewbox>
                                                <TextBlock Text="Not Found" Foreground="#ff8686" Margin="8 0 0 0" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Type" Binding="{Binding ZoningType}" Width="100" />
                        <DataGridTextColumn Header="City" Binding="{Binding City}" Width="Auto" />
                        <DataGridTextColumn Header="Address" Binding="{Binding Address}"  Width="Auto"/>
                        <DataGridTextColumn Header="Owner" Binding="{Binding OwnerName}"  Width="Auto"/>
                        <DataGridTextColumn Header="Assessed" Binding="{Binding AssessedValue, StringFormat=C}" Width="Auto" />
                        <DataGridTextColumn Header="Acres" Binding="{Binding Acres}" Width="80" />
                        <DataGridTemplateColumn Header="GIS" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button 
                                        Content="LINK"
                                        Style="{StaticResource Buttons.Hyperlink}"
                                        Command="{Binding DataContext.NavigateToRegridCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                        CommandParameter="{Binding}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <!-- Ensure copied content includes the URL -->
                            <DataGridTemplateColumn.ClipboardContentBinding>
                                <Binding Path="RegridUrl"/>
                            </DataGridTemplateColumn.ClipboardContentBinding>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="Maps" Width="80" >
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button 
                                        Content="LINK"
                                        Style="{StaticResource Buttons.Hyperlink}"
                                        Command="{Binding DataContext.NavigateToGoogleMapsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                        CommandParameter="{Binding}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <!-- Ensure copied content includes the URL -->
                            <DataGridTemplateColumn.ClipboardContentBinding>
                                <Binding Path="GoogleUrl"/>
                            </DataGridTemplateColumn.ClipboardContentBinding>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="Fema" Width="80" >
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button 
                                        Content="{Binding FloodZone}"
                                        Style="{StaticResource Buttons.Hyperlink}"
                                        Command="{Binding DataContext.NavigateToFemaCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                        CommandParameter="{Binding}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <!-- Ensure copied content includes the URL -->
                            <DataGridTemplateColumn.ClipboardContentBinding>
                                <Binding Path="FemaUrl"/>
                            </DataGridTemplateColumn.ClipboardContentBinding>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="Realtor" Width="95" >
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button 
                                        Content="LINK"
                                        Style="{StaticResource Buttons.Hyperlink}"
                                        Command="{Binding DataContext.NavigateToRealtorCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                        CommandParameter="{Binding}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <!-- Ensure copied content includes the URL -->
                            <DataGridTemplateColumn.ClipboardContentBinding>
                                <Binding Path="RealtorUrl"/>
                            </DataGridTemplateColumn.ClipboardContentBinding>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="Redfin" Width="85" >
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button 
                                        Content="LINK"
                                        Style="{StaticResource Buttons.Hyperlink}"
                                        Command="{Binding DataContext.NavigateToRedfinCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                        CommandParameter="{Binding}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <!-- Ensure copied content includes the URL -->
                            <DataGridTemplateColumn.ClipboardContentBinding>
                                <Binding Path="RedfinUrl"/>
                            </DataGridTemplateColumn.ClipboardContentBinding>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="Zillow">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button 
                                        Content="LINK"
                                        Style="{StaticResource Buttons.Hyperlink}"
                                        Command="{Binding DataContext.NavigateToZillowCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                        CommandParameter="{Binding}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <!-- Ensure copied content includes the URL -->
                            <DataGridTemplateColumn.ClipboardContentBinding>
                                <Binding Path="ZillowUrl"/>
                            </DataGridTemplateColumn.ClipboardContentBinding>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="Details" Width="*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button 
                                        Content="LINK"
                                        Style="{StaticResource Buttons.Hyperlink}"
                                        Command="{Binding DataContext.NavigateDetailsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                        CommandParameter="{Binding}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <!-- Ensure copied content includes the URL -->
                            <DataGridTemplateColumn.ClipboardContentBinding>
                                <Binding Path="DetailsUrl"/>
                            </DataGridTemplateColumn.ClipboardContentBinding>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                    <!-- Context Menu -->
                    <DataGrid.ContextMenu>
                        <ContextMenu Style="{StaticResource ContextMenuStyle}">
                            <MenuItem Style="{StaticResource MenuItemStyle}" Header="Copy Selected Parcels to Clipboard" Command="{Binding CopySelectedParcelsCommand}" IsEnabled="{Binding ParcelsSelected}">
                                <MenuItem.Icon>
                                    <Viewbox Width="16" Height="16">
                                        <Path Data="{StaticResource Geometry.Copy}" />
                                    </Viewbox>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Style="{StaticResource MenuItemStyle}" Header="Fetch Selected Parcels from Regrid" Command="{Binding RegridQuerySelectedCommand}" IsEnabled="{Binding ParcelsSelected}">
                                <MenuItem.Icon>
                                    <Viewbox Width="16" Height="16">
                                        <Path Data="{StaticResource Geometry.Regrid}" />
                                    </Viewbox>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Style="{StaticResource MenuItemStyle}" Header="Alternate Address" Command="{Binding OpenStreetQuerySelectedParcelsCommand}" IsEnabled="{Binding ParcelsSelected}">
                                <MenuItem.Icon>
                                    <Viewbox Width="16" Height="16">
                                        <Path Data="{StaticResource Geometry.MapOutline}" />
                                    </Viewbox>
                                </MenuItem.Icon>
                            </MenuItem>
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="SelectionChanged">
                            <i:InvokeCommandAction Command="{Binding SelectedParcelsCommand}" CommandParameter="{Binding SelectedItems, RelativeSource={RelativeSource AncestorType=DataGrid}}" />
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </DataGrid>
            </Grid>
        </Border>
    </Grid>
</UserControl>